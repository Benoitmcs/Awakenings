<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Awakenings Mental Health</title>

  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>

  <style>
    :root {
      --primary: #2F3E46; 
      --accent: #E07A5F;    
      --bg-light: #f1f1f2;    
      --text-dark: #1c1c1c;   
      --heading-color: #27296d; 
      --theme-blue-static: #27296d; 
      --bg-dark: #1D2021;
      --text-light: #F0F3F4;
    }
    html.dark { 
      --bg-light: var(--bg-dark);
      --text-dark: var(--text-light);
      --heading-color: var(--text-light); 
    }
    html.dark .testimonial-card { background: #2c3032; }
    html.dark .card:not(.no-dark-override){ 
        background: #272b2c; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
    }
    html.dark .card header,
    html.dark .accordion .acc-header,
    html.dark .btn, html.dark .btn.secondary, 
    html.dark #to-top {
        background: var(--theme-blue-static); 
        color: white; 
    }
    html.dark .accordion .acc-header.active {
        background: var(--accent);
    }
    html.dark .accordion .acc-body { background: #2c3032; }
    html.dark .skeleton { background: #444; }
    html.dark .separator path { fill: var(--bg-dark); } 
    
    html.dark .btn:active, html.dark .btn.secondary:active, html.dark #to-top:active {
        background-color: var(--bg-dark); 
        color: var(--text-light);    
    }
    html.dark footer#contact { 
        color: var(--text-light);
        background-color: var(--bg-dark); 
    }
    html.dark footer#contact .footer-text-content a {
        color: var(--accent); 
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif; 
      background: var(--bg-light); color: var(--text-dark);
      line-height: 1.6; transition: background .3s, color .3s;
      overflow-x: hidden; 
    }
    header#site-header {
      position: fixed; top: 0; left: 0; width: 100%;
      /* Sketch image moved to ::before pseudo-element */
      background-color: transparent; /* Ensure initial background is transparent */
      display: flex; align-items: center; 
      /* background-image transition removed, handled by ::before opacity */
      /* background-color transition removed, will be handled by JS */
      transition: box-shadow 0.15s ease, height 0.05s ease; /* Removed justify-content from transition */
      z-index: 1000; padding: 0 1rem; 
      justify-content: flex-start; /* Default to flex-start for h1 positioning */
    }

    /* New pseudo-element for the sketch image background */
    header#site-header::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url('Wide Awakenings Building Sketch.png') center/cover no-repeat;
      opacity: var(--header-bg-image-opacity, 1); /* Use CSS variable */
      transition: opacity 0.3s ease;
      z-index: -2; /* Behind the ::after overlay and content */
    }

    header#site-header::after { 
      content: ''; position: absolute; inset: 0;
      background: rgba(47,62,70,0.2); /* Overlay for the sketch */
      z-index: -1; /* Above ::before, below content */
      transition: opacity 0.3s ease; 
      opacity: var(--header-bg-overlay-opacity, 1); /* Use CSS variable */
    }
    /* :not(.scrolled-header-layout) no longer needed for justify-content */
    
    .scrolled-header-layout {
      /* justify-content: space-between !important; -- No longer needed here for h1, nav is absolute */
      align-items: center !important; 
      /* background-image: none; -- No longer needed, ::before opacity handles this */
      /* background-color: var(--theme-blue-static); -- Removed, JS will handle background color animation */
      box-shadow: 0 2px 8px rgba(0,0,0,.2);
    }

    /* When scrolled, fade out the sketch image and its overlay */
    /* .scrolled-header-layout::before,
    .scrolled-header-layout::after {
        opacity: 0; 
    } */

    header#site-header h1 {
      position: relative; 
      font-family: 'Dancing Script', cursive; font-weight: 600;
      z-index: 1; 
      margin: 0; 
      display: flex; 
      align-items: center; 
      /* transition for properties changed by JS/scroll - background-color and padding removed as JS will handle them */
      transition: font-size 0.3s ease, color 0.3s ease;
    }

    /* Base styles for H1, including the rounded box properties */
    header#site-header h1 {
      font-size: 3.2rem; /* Initial font size */
      background-color: rgba(220, 220, 220, 0.85); /* Initial silverish background */
      padding: 0.5rem 1rem; /* Constant padding for the box */
      border-radius: 8px; /* Constant border-radius */
      color: var(--theme-blue-static); /* Initial text color */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Initial shadow for the box */
      /* position: relative; font-family, z-index etc. are already set above */
    }

    /* Styles for H1 when header is scrolled (mostly handled by JS now) */
    .scrolled-header-layout h1 {
      /* font-size will be interpolated by JS */
      /* line-height: 1.2; */ /* Can be kept or removed if JS handles size well */
      /* color will be interpolated by JS to white */
      text-align: left; /* Keep this for final state */
      /* background-color will be interpolated to transparent by JS */
      /* padding is now constant */
      box-shadow: none; /* Remove box shadow in scrolled state */
    }

    .header-favicon {
      display: inline-block; 
      opacity: 0; 
      /* width and height will be controlled by JS */
      margin-right: 10px; 
      vertical-align: middle; 
    }
    header#site-header h1 .title-short { 
      display: inline-block; 
      opacity: 0; 
      vertical-align: middle;
    }
    header#site-header h1 .title-full { 
      display: inline-block;
      opacity: 1; 
      vertical-align: middle;
    }

    header#site-header nav { 
      position: absolute; 
      top: 1rem; /* Default unscrolled top */
      right: 1rem; /* Default unscrolled right */
      z-index: 1002; 
      display: flex; 
      align-items: center; /* Vertically center links within the nav block */
      gap: 0.6rem; /* Consistent gap */
      transition: top 0.3s ease, right 0.3s ease, opacity 0.3s ease; /* For smooth movement */
    }
    .scrolled-header-layout nav { 
      /* position: absolute; is inherited */
      /* display: flex; align-items: center; gap: 0.6rem; are inherited */
      /* top and right will be controlled by JavaScript for scrolled state */
      /* height: 100%; removed as it's not needed with absolute positioning and calculated top */
    }
    nav .nav-link { 
      text-decoration: none; font-family: 'Inter', sans-serif; 
      font-weight: 600; font-size: 1.6rem; /* 50% of 3.2rem title */
      white-space: nowrap;
      line-height: 1.2; 
      padding: 0.4em 0.8em; /* Padding for bubble effect */
      display: inline-block; 
      border-radius: 25px; /* Rounded bubbles */
      background-color: rgba(220, 220, 220, 0.3); /* Light bubble background for unscrolled */
      color: var(--theme-blue-static); /* Text color for unscrolled */
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }
    .scrolled-header-layout nav .nav-link { 
        color: white !important;
        background-color: rgba(255, 255, 255, 0.25); /* Slightly different bubble for scrolled */
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    nav .nav-link:hover { 
      color: var(--accent); 
      background-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    h2 { 
      font-family: 'Dancing Script', cursive; font-weight: 600;
      color: var(--heading-color);
      text-align: center; 
      margin-bottom: 2rem; 
      font-size: 2.2rem; 
    }
    #testimonials h2, #location h2, #booking h2, 
    #services h2, 
    #insurance h2 { 
        font-size: 2.2rem; 
        margin-bottom: 2rem; 
        text-align: center; 
    }
    #location h2 { text-align: center; }

    @media (max-width: 480px) {
      header#site-header:not(.scrolled-header-layout) h1 { font-size: 1.8rem; } 
      
      .scrolled-header-layout h1 { 
        font-size: 3.2rem; 
        line-height: 1.2; 
        white-space: nowrap;    
        overflow: hidden;       
        text-overflow: ellipsis;
        margin-right: 3px;      
        min-width: 0; 
        flex-shrink: 1; 
      }
      .scrolled-header-layout h1 .header-favicon {
          margin-right: 4px !important; 
      }
            
      #services .card header { text-align: center; } 
      
      header#site-header:not(.scrolled-header-layout) nav { 
        gap: 0.25rem; 
        right: 0.5rem; /* Closer to edge for unscrolled mobile */
        /* top: 1rem; is inherited */
      }
      .scrolled-header-layout nav { 
        gap: 0.2rem !important; /* Keep specific mobile scrolled gap */
        flex-shrink: 0; /* Keep if it was important for mobile layout */
        /* Scrolled mobile nav top is calculated like desktop, right is 1rem like desktop */
        /* If header padding is different on mobile, right might need adjustment here */
      }
      /* All specific nav-link font sizes for mobile are removed, base 1.6rem applies */
      nav .nav-link {
        font-size: 1.2rem; /* Adjusted for mobile */
        padding: 0.3em 0.6em; /* Adjusted padding for smaller font */
      }
    }

    /* All specific nav-link font sizes for desktop scrolled are removed, base 1.6rem applies */

    .container { 
      max-width: 1000px; margin: 0 auto; 
      padding: 2rem 1rem 100px; 
    }
    .grid-2 { display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 2rem; align-items: start; margin-bottom: 3rem; }
    .card { background: var(--bg-light); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); overflow: hidden; }
    .card.no-dark-override {}
    .card header { 
      padding: 1rem; 
      background: var(--theme-blue-static); 
      color: white; 
      font-family: 'Dancing Script', cursive; font-weight: 600; font-size: 1.4rem; 
    }
    #services .card header { text-align: center; } 
    .card .content { padding: 1rem; }
    .btn { 
      display: inline-block; 
      background: var(--theme-blue-static); 
      color: white; 
      padding: 0.75rem 1.5rem; border-radius: 4px; text-decoration: none; 
      font-weight: 600; margin: 0.5rem; 
      transition: background-color .2s, color .2s, opacity .3s; 
    }
    .btn.secondary { 
      background: var(--theme-blue-static); 
    }
    .btn:hover { opacity: .9; }
    .btn:active, .btn.secondary:active { 
        background-color: var(--bg-light); 
        color: var(--theme-blue-static);    
        opacity: 1;
    }
    .booking-button-container { padding: 1rem; }
    .separator { display: block; width: 100%; height: 80px; }
    .separator path { transition: fill .3s; } 
    .accordion .acc-header { 
      background: var(--theme-blue-static); 
      color: white; cursor: pointer; 
      padding: 1rem; border: none; width: 100%; text-align: left; 
      outline: none; font-family: 'Inter', sans-serif; 
      font-weight: 600; font-size: 1.1rem; 
      transition: background .3s; 
    }
    .accordion .acc-header.active { background: var(--accent); }
    .accordion .acc-header + .acc-body + .acc-header { margin-top: 0.5rem; }
    .accordion .acc-body { max-height: 0; overflow: hidden; transition: max-height .3s ease; background: white; padding: 0 1rem; }
    .accordion .acc-body p { padding: 1rem 0; }
    .skeleton { background: #ddd; position: relative; }
    #testimonials { padding: 2rem 0; }
    .testimonial-card { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); font-style: italic; text-align: center; margin-bottom: 1.5rem; max-width: 650px; margin-left: auto; margin-right: auto; }
    .testimonial-card:last-child { margin-bottom: 0; }
    #to-top { 
      position: fixed; bottom: 2rem; right: 2rem; 
      background: var(--theme-blue-static); 
      border: none; color: white; 
      padding: 0.75rem; border-radius: 50%; font-size: 1.2rem; 
      cursor: pointer; opacity: 0; 
      transition: background-color .2s, opacity .3s; 
      z-index: 10001; 
    }
    #to-top:active { 
        background-color: var(--bg-light); 
        color: var(--theme-blue-static);    
        opacity: 1;
    }
    body.scrolled #to-top { opacity: 1; } 
    section#location address { text-align: center; margin-top: 0.5rem; }
    
    footer#contact {
        text-align:center; 
        padding: 2rem 1rem 1rem; 
        background-color: var(--bg-light); 
        position: relative;
        color: var(--text-dark); 
    }
    .footer-logo-container { 
        margin-bottom: 1.5rem; 
    }
    .footer-logo-container img {
        max-width: 250px; 
        height: auto;
        display: block; 
        margin: 0 auto; 
    }
    .footer-text-content { 
        padding: 0; 
    }
    html.dark footer#contact { 
        background-color: var(--bg-dark); 
        color: var(--text-light); 
    }
    
    footer#contact p {
        margin-bottom: 0.5rem;
    }
    footer#contact p:last-child {
        margin-bottom: 0;
    }
    footer#contact a {
        color: var(--accent); 
    }
  </style>
</head>
<body>

  <header id="site-header"> <h1 data-aos="fade-down">
      <img src="Square Logo.png" alt="Awakenings Logo" class="header-favicon">
      <span class="title-main-word">Awakenings</span> <span class="title-secondary-words">Mental Health</span>
    </h1> 
    <nav>
      <a href="index.html" class="nav-link" target="_top">Home</a>
      <a href="our-providers.html" class="nav-link" target="_top">Our Providers</a>
      <a href="articles.html" class="nav-link" target="_top">Articles</a>
    </nav>
  </header>

  <main class="container">
    <svg class="separator" viewBox="0 0 1200 100" preserveAspectRatio="none" data-aos="fade-up">
      <path d="M0,0 C300,100 900,0 1200,100 L1200,0 L0,0 Z" fill="var(--bg-light)"/>
    </svg>

    <section id="services" class="grid-2" data-aos="fade-up">
      <div class="card" data-aos="zoom-in"> 
        <header>Individual Therapy</header> 
        <div class="content"> <p>Personalized support for anxiety, depression, and life transitions.</p> </div> 
      </div>
      <div class="card" data-aos="zoom-in" data-aos-delay="100"> 
        <header>Medication Management</header> 
        <div class="content"> <p>Expert psychiatric care to optimize your treatment plan.</p> </div> 
      </div>
    </section>

    <svg class="separator" viewBox="0 0 1200 100" preserveAspectRatio="none"> <path d="M0,0 C300,100 900,0 1200,100 L1200,0 L0,0 Z" fill="var(--bg-light)"/> </svg>

    <section id="testimonials" data-aos="fade-up">
      <h2>What Our Clients Say</h2>
      <div class="testimonial-card" data-aos="fade-up">“Awakenings changed my life…” — A. Smith</div>
      <div class="testimonial-card" data-aos="fade-up" data-aos-delay="100">“Professional, caring, and effective.” — J. Doe</div>
      <div class="testimonial-card" data-aos="fade-up" data-aos-delay="200">“I finally feel heard and supported.” — K. Lee</div>
    </section>

    <svg class="separator" viewBox="0 0 1200 100" preserveAspectRatio="none"> <path d="M0,100 C300,0 900,100 1200,0 L1200,100 L0,100 Z" fill="var(--bg-light)"/> </svg>

    <section id="location" class="grid-2" data-aos="fade-right">
      <div> 
        <h2>Our Location</h2> 
        <address> 
          6126 W State St #104<br> 
          Boise, ID 83703 
        </address> 
      </div>
      <iframe class="skeleton lazy-embed" loading="lazy" src="https://maps.google.com/maps?q=6126%20W%20State%20St%20%23104%2C%20Boise%2C%20ID%2083703&t=&z=17&ie=UTF8&iwloc=&output=embed" width="100%" height="250" style="border:0;" allowfullscreen=""> </iframe>
    </section>

    <svg class="separator" viewBox="0 0 1200 100" preserveAspectRatio="none"> <path d="M0,0 C300,100 900,0 1200,100 L1200,0 L0,0 Z" fill="var(--bg-light)"/> </svg>

    <section id="insurance" data-aos="fade-left">
      <div class="accordion card">
        <button class="acc-header">What insurances do you accept?</button> <div class="acc-body"> <p>Blue Cross, Select Health, Pacific Source, Saint Luke's Health Plan, Anthem Blue Cross. Blue Shield, Regence, Aetna, Cash Pay</p> </div>
        <button class="acc-header">How do I verify coverage?</button> <div class="acc-body"> <p>Contact our office <a href="tel:2082950297" style="color: var(--accent);">(208)295-0297</a></p> </div>
      </div>
    </section>

    <svg class="separator" viewBox="0 0 1200 100" preserveAspectRatio="none"> <path d="M0,100 C300,0 900,100 1200,0 L1200,100 L0,100 Z" fill="var(--bg-light)"/> </svg>

    <section id="booking" data-aos="zoom-in-up" style="text-align:center; margin-bottom:3rem;">
      <h2>Book an Appointment</h2>
      <div class="booking-button-container"> 
          <a href="https://www.therapyportal.com/p/awakenings83703/" class="btn" target="_blank" rel="noopener noreferrer"> Patient Portal </a>
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSeeYABYxDoscWL3jH-SNU51X0hgomcb0bEqshRIUnCRg7aSgA/viewform" class="btn secondary" target="_blank" rel="noopener noreferrer"> Appointment Interest Form </a>
      </div>
    </section>
  </main>

  <button id="to-top">▲</button>

  <footer id="contact" data-aos="fade-up">
    <div class="footer-logo-container">
        <img src="Rectangle Logo.jpg" alt="Awakenings Mental Health Logo">
    </div>
    <div class="footer-text-content"> 
      <p>© <span id="current-year">2025</span> Awakenings Mental Health</p>
      <p>Questions? <a href="mailto:admin@awakeningsmentalhealth.com">admin@awakeningsmentalhealth.com</a> <a href="tel:2082950297">(208)295-0297</a></p>
    </div>
  </footer>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <script>
    document.getElementById('current-year').textContent = new Date().getFullYear();
    AOS.init({ duration: 600, once: true });

    const toTop = document.getElementById('to-top');
    if (toTop) toTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    
    const siteHeader = document.getElementById('site-header');
    const mainContainer = document.querySelector('main.container'); // Get main container
    const h1Title = siteHeader ? siteHeader.querySelector('h1') : null; 
    const titleMainWord = h1Title ? h1Title.querySelector('.title-main-word') : null;
    const titleSecondaryWords = h1Title ? h1Title.querySelector('.title-secondary-words') : null;
    const headerFavicon = h1Title ? h1Title.querySelector('.header-favicon') : null;
    const navElement = siteHeader ? siteHeader.querySelector('nav') : null;

    let initialHeaderHeightVh = 30; // Default for desktop, changed from const to let
    const finalHeaderHeightPx = 90; /* Increased header height for larger scrolled title */

    let initialH1FontSizeRem = 3.2; /* Default to 3.2rem as per unscrolled CSS */
    if(h1Title) {
        const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
        const computedFontSize = parseFloat(getComputedStyle(h1Title).fontSize);
        if (rootFontSize > 0 && computedFontSize > 0) { 
            initialH1FontSizeRem = computedFontSize / rootFontSize;
        }
    }
    
    const finalH1DesktopFontSizeRem = 3.2; /* Title Short will be same size as Title Full */
    const finalH1MobileFontSizeRem = 1.6;  /* Adjusted: Title Short will be smaller on mobile */

    const initialFaviconSizePx = 0; // Favicon will grow from this size
    const finalFaviconSizePx = 64;  // Increased target favicon size in scrolled state

    const initialH1ColorHex = "#27296d"; 
    const finalH1ColorHex = "#FFFFFF";   

    const animationScrollStart = 0;
    const animationScrollEnd = 200; 

    function hexToRgb(hex) {
        let r = 0, g = 0, b = 0;
        if (hex.length == 4) { 
            r = parseInt(hex[1] + hex[1], 16);
            g = parseInt(hex[2] + hex[2], 16);
            b = parseInt(hex[3] + hex[3], 16);
        } else if (hex.length == 7) { 
            r = parseInt(hex[1] + hex[2], 16);
            g = parseInt(hex[3] + hex[4], 16);
            b = parseInt(hex[5] + hex[6], 16);
        }
        return [r, g, b];
    }
    
    const initialH1ColorRgb = hexToRgb(initialH1ColorHex);
    const finalH1ColorRgb = hexToRgb(finalH1ColorHex);

    function interpolateValue(start, end, progress) {
        return start + (end - start) * progress;
    }

    function interpolateRgbColor(colorStartRgb, colorEndRgb, progress) {
        const r = Math.round(interpolateValue(colorStartRgb[0], colorEndRgb[0], progress));
        const g = Math.round(interpolateValue(colorStartRgb[1], colorEndRgb[1], progress));
        const b = Math.round(interpolateValue(colorStartRgb[2], colorEndRgb[2], progress));
        return `rgb(${r},${g},${b})`;
    }

    let lastKnownScrollY = 0;
    let ticking = false;
    let lastKnownSecondaryWordsWidth = 0; // To store the width of the secondary words

    function updateHeaderStylesOnScroll(scrollY) {
      if (!siteHeader || !h1Title || !mainContainer) return;

      let progress = 0;
      if (scrollY <= animationScrollStart) {
        progress = 0;
      } else if (scrollY >= animationScrollEnd) {
        progress = 1;
      } else {
        progress = (scrollY - animationScrollStart) / (animationScrollEnd - animationScrollStart);
      }
      progress = Math.max(0, Math.min(1, progress));

      requestAnimationFrame(() => {
        // Get initial h1 width when progress is 0 for accurate centering calculation later
        // This assumes h1 content doesn't drastically change width before this animation starts
        const h1InitialOffsetWidth = h1Title.offsetWidth; 
        const siteHeaderWidth = siteHeader.offsetWidth;

        // Adjust initialHeaderHeightVh for mobile
        const currentInitialHeaderHeightVh = window.innerWidth <= 480 ? 20 : initialHeaderHeightVh; // Use 20vh for mobile

        const initialHeaderActualHeight = (currentInitialHeaderHeightVh / 100) * window.innerHeight;
        const currentHeaderHeight = interpolateValue(initialHeaderActualHeight, finalHeaderHeightPx, progress);
        siteHeader.style.height = `${currentHeaderHeight}px`;
        mainContainer.style.paddingTop = `${currentHeaderHeight}px`; // Dynamically set padding

        // Determine the actual initial H1 font size based on CSS for unscrolled state
        let actualUnscrolledH1FontSizeRem;
        if (window.innerWidth <= 480) {
            actualUnscrolledH1FontSizeRem = 1.8; // As per CSS: @media (max-width: 480px) header#site-header:not(.scrolled-header-layout) h1
        } else {
            actualUnscrolledH1FontSizeRem = initialH1FontSizeRem; // This is 3.2rem, from JS vars, matches CSS for desktop
        }

        let targetFinalH1FontSize = window.innerWidth <= 480 ? finalH1MobileFontSizeRem : finalH1DesktopFontSizeRem;
        let currentH1FontSize;

        if (window.innerWidth <= 480) {
            const shrinkStartProgress = 0.1;
            const shrinkEndProgress = 0.6;
            const shrinkAmountRem = 0.2;

            // Font size that the general interpolation (actualUnscrolled to targetFinal) would achieve at shrinkStartProgress
            const baseSizeAtShrinkStart = interpolateValue(actualUnscrolledH1FontSizeRem, targetFinalH1FontSize, shrinkStartProgress);
            
            if (progress < shrinkStartProgress) {
                // Interpolate from actual unscrolled size towards the size it's supposed to be just before the special shrink phase begins.
                // The progress here is normalized for this segment (0 to shrinkStartProgress).
                currentH1FontSize = interpolateValue(actualUnscrolledH1FontSizeRem, baseSizeAtShrinkStart, progress / shrinkStartProgress);
            } else if (progress >= shrinkStartProgress && progress <= shrinkEndProgress) {
                // During the special shrink phase
                // The font size starts at baseSizeAtShrinkStart and ends at baseSizeAtShrinkStart - shrinkAmountRem.
                const targetSizeAtShrinkEnd = baseSizeAtShrinkStart - shrinkAmountRem;
                // Progress normalized for this segment (shrinkStartProgress to shrinkEndProgress).
                const phaseProgress = (progress - shrinkStartProgress) / (shrinkEndProgress - shrinkStartProgress);
                currentH1FontSize = interpolateValue(baseSizeAtShrinkStart, targetSizeAtShrinkEnd, phaseProgress);
            } else { // progress > shrinkEndProgress
                // After the special shrink phase
                // The font size at the end of the shrink phase was baseSizeAtShrinkStart - shrinkAmountRem.
                const fontSizeAfterShrink = baseSizeAtShrinkStart - shrinkAmountRem;
                // Interpolate from this shrunken size towards the overall targetFinalH1FontSize.
                // Progress normalized for this segment (shrinkEndProgress to 1.0).
                const phaseProgress = (1.0 - shrinkEndProgress === 0) ? 1 : (progress - shrinkEndProgress) / (1.0 - shrinkEndProgress); // Avoid division by zero if shrinkEndProgress is 1
                currentH1FontSize = interpolateValue(fontSizeAfterShrink, targetFinalH1FontSize, phaseProgress);
            }
        } else {
            // Desktop behavior: simple interpolation from its unscrolled size to its final scrolled size.
            currentH1FontSize = interpolateValue(actualUnscrolledH1FontSizeRem, targetFinalH1FontSize, progress);
        }
        h1Title.style.fontSize = `${currentH1FontSize}rem`;
        
        // Text box background opacity: fades 15% faster
        const backgroundOpacityProgress = Math.min(1, progress / 0.85);
        h1Title.style.backgroundColor = `rgba(220, 220, 220, ${interpolateValue(0.85, 0, backgroundOpacityProgress)})`;

        // Animate padding-right of the h1 text box to shrink its right side
        const paddingAnimationStartProgress = 0.6;
        const paddingAnimationEndProgress = 0.9;
        let currentPaddingRightRem;
        const rootFontSizePx = parseFloat(getComputedStyle(document.documentElement).fontSize);

        if (progress < paddingAnimationStartProgress) {
            currentPaddingRightRem = 1; // Default right padding (from initial 0.5rem 1rem)
        } else if (progress >= paddingAnimationEndProgress) {
            currentPaddingRightRem = 0.5; // Target final right padding
        } else {
            // Calculate progress specifically for this padding animation phase
            const paddingSpecificProgress = (progress - paddingAnimationStartProgress) / (paddingAnimationEndProgress - paddingAnimationStartProgress);
            // Initial padding for this animation phase includes the width of secondary words
            let initialPaddingForAnimationRem = 1; // Base right padding
            if (rootFontSizePx > 0 && lastKnownSecondaryWordsWidth > 0) {
                initialPaddingForAnimationRem += (lastKnownSecondaryWordsWidth / rootFontSizePx);
            }
            currentPaddingRightRem = interpolateValue(initialPaddingForAnimationRem, 0.5, paddingSpecificProgress);
        }
        h1Title.style.paddingRight = `${currentPaddingRightRem}rem`;
        // padding-left, top, bottom remain as set in CSS (0.5rem top/bottom, 1rem left initially, then padding-right changes)

        // Animation for titleSecondaryWords ("Mental Health")
        const secondaryFadeStartProgress = 0.1; // Start fading "Mental Health" a bit after scroll starts
        const secondaryFadeEndProgress = 0.6;   // "Mental Health" fully faded by this point
        let secondaryOpacity = 1;

        if (progress <= secondaryFadeStartProgress) {
            secondaryOpacity = 1;
        } else if (progress >= secondaryFadeEndProgress) {
            secondaryOpacity = 0;
        } else {
            secondaryOpacity = 1 - ((progress - secondaryFadeStartProgress) / (secondaryFadeEndProgress - secondaryFadeStartProgress));
        }
        
        if (titleSecondaryWords) {
            titleSecondaryWords.style.opacity = secondaryOpacity;
            if (secondaryOpacity <= 0.01) {
                titleSecondaryWords.style.display = 'none';
            } else {
                titleSecondaryWords.style.display = 'inline-block';
                lastKnownSecondaryWordsWidth = titleSecondaryWords.offsetWidth; // Capture width when visible
            }
        }

        // Favicon: Fades in as "Mental Health" fades out, or slightly delayed
        const faviconFadeStartProgress = 0.2; 
        const faviconFadeEndProgress = 0.7;
        let faviconOpacity = 0;

        if (progress <= faviconFadeStartProgress) {
            faviconOpacity = 0;
        } else if (progress >= faviconFadeEndProgress) {
            faviconOpacity = 1;
        } else {
            faviconOpacity = (progress - faviconFadeStartProgress) / (faviconFadeEndProgress - faviconFadeStartProgress);
        }

        if (headerFavicon) {
            headerFavicon.style.opacity = faviconOpacity;
            const currentFaviconSize = interpolateValue(initialFaviconSizePx, finalFaviconSizePx, faviconOpacity); // Link size to its own opacity progress
            headerFavicon.style.width = `${currentFaviconSize}px`;
            headerFavicon.style.height = `${currentFaviconSize}px`;
            if (faviconOpacity > 0.01) {
                headerFavicon.style.display = 'inline-block';
            } else {
                headerFavicon.style.display = 'none';
            }
        }
        
        // Ensure titleMainWord is always displayed (it doesn't fade itself, its container h1 changes color)
        if (titleMainWord) {
            titleMainWord.style.display = 'inline-block'; // Ensure it's always visible
            // Opacity for titleMainWord could be 1, or tied to overall progress if a subtle fade-in is desired for it
            // For now, let's assume it's always fully opaque relative to its container.
        }

        // Set CSS variables for pseudo-element opacity (sketch background)
        siteHeader.style.setProperty('--header-bg-image-opacity', 1 - progress);
        siteHeader.style.setProperty('--header-bg-overlay-opacity', 1 - progress);
        
        // Animate header background color (to solid blue)
        const themeBlueStaticRGB = hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--theme-blue-static').trim());
        siteHeader.style.backgroundColor = `rgba(${themeBlueStaticRGB[0]}, ${themeBlueStaticRGB[1]}, ${themeBlueStaticRGB[2]}, ${progress})`;

        // H1 text color transitions from initial (blue) to final (white)
        h1Title.style.color = interpolateRgbColor(initialH1ColorRgb, finalH1ColorRgb, progress);

        // Animate H1 horizontal position using translateX, from centered to flex-start position
        if (h1Title && siteHeaderWidth > 0 && h1InitialOffsetWidth > 0) {
            const siteHeaderPaddingLeft = parseFloat(getComputedStyle(siteHeader).paddingLeft) || 0;
            // Calculate the offset needed to center h1 from its natural flex-start position
            const translateXForCentering = (siteHeaderWidth / 2) - (h1InitialOffsetWidth / 2) - siteHeaderPaddingLeft;
            
            // Interpolate translateX from this centering offset down to 0 (natural flex-start position)
            const currentTranslateX = interpolateValue(translateXForCentering, 0, progress);
            h1Title.style.transform = `translateX(${currentTranslateX}px)`;
        }
        
        // Apply scrolled-header-layout class for box-shadow on header (and potentially nav if it wasn't absolute)
        if (progress > 0.5) { // Threshold for applying scrolled class (e.g., for box-shadow)
          siteHeader.classList.add('scrolled-header-layout');
          if (navElement) {
            navElement.style.top = '1.3rem'; // Raised slightly: JS controlled top for scrolled
            navElement.style.right = '1rem'; // JS controlled right for scrolled
          }
        } else {
          siteHeader.classList.remove('scrolled-header-layout');
          if (navElement) {
            navElement.style.top = '1rem'; // JS controlled top for unscrolled
            navElement.style.right = window.innerWidth <= 480 ? '0.5rem' : '1rem'; // JS controlled right for unscrolled
          }
        }
      });
    }

    // Removed setInitialH1FontSize function

    window.addEventListener('scroll', () => {
        lastKnownScrollY = window.scrollY;
        if (!ticking) {
            window.requestAnimationFrame(() => {
                updateHeaderStylesOnScroll(lastKnownScrollY);
                document.body.classList.toggle('scrolled', lastKnownScrollY > 50); 
                ticking = false;
            });
            ticking = true;
        }
    });
    window.addEventListener('resize', () => { 
        // setInitialH1FontSize(); // Removed call
        updateHeaderStylesOnScroll(window.scrollY); 
    });
    document.addEventListener('DOMContentLoaded', () => { 
        // setInitialH1FontSize(); // Removed call
        updateHeaderStylesOnScroll(window.scrollY); 
    });

    const applySystemTheme = (isDark) => {
        document.documentElement.classList.toggle('dark', isDark);
        if (typeof AOS !== 'undefined') AOS.refreshHard(); 
        let currentBg = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--bg-dark' : '--bg-light').trim();
        document.querySelectorAll('.separator path').forEach(p => p.style.fill = currentBg);
    };

    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    applySystemTheme(prefersDarkScheme.matches); 
    prefersDarkScheme.addEventListener('change', (e) => applySystemTheme(e.matches));
    
    window.addEventListener('load', function() {
      if (typeof AOS !== 'undefined') setTimeout(() => AOS.refreshHard(), 1200); 
      // setInitialH1FontSize(); // Removed call
      updateHeaderStylesOnScroll(window.scrollY); 
    });

    const accordionHeaders = document.querySelectorAll('.accordion .acc-header');
    if (accordionHeaders.length > 0) {
        accordionHeaders.forEach(btn => {
          btn.addEventListener('click', () => {
            btn.classList.toggle('active');
            const body = btn.nextElementSibling;
            body.style.maxHeight = btn.classList.contains('active') ? body.scrollHeight + 'px' : '0';
          });
        });
    }

    const lazyIframes = document.querySelectorAll('iframe.lazy-embed');
    if (lazyIframes.length > 0) {
        lazyIframes.forEach(iframe => { 
          if (iframe.classList.contains('skeleton')) { 
              iframe.addEventListener('load', () => {
                  iframe.classList.remove('skeleton');
                  if (typeof AOS !== 'undefined') { 
                    AOS.refresh(); 
                  }
              });
          }
        });
    }
  </script>
</body>
</html>
